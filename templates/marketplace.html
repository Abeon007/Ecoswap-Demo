{% extends "base.html" %}

{% block title %}{{ t('common.marketplace') }} - {{ t('common.appName') }}{% endblock %}

{% block content %}
<section class="marketplace-section">
    <div class="container">
        <div class="page-header">
            <h1>{{ t('common.marketplace') }}</h1>
            <p>{{ t('home.exploreMarketplace') }}</p>
        </div>

        <div class="search-filters">
            <form method="GET" action="{{ url_for('marketplace') }}">
                <div class="search-bar">
                    <input type="text" name="search" placeholder="{{ t('marketplace.searchPlaceholder') }}"
                        value="{{ request.args.get('search', '') }}">
                    <button type="submit" class="btn-primary">{{ t('marketplace.searchButton') }}</button>
                </div>
                <div class="filters">
                    <select name="category">
                        <option value="">{{ t('marketplace.allCategories') }}</option>
                        {% for cat in ["Furniture", "Electronics", "Books", "Clothing", "Sports", "Home & Garden",
                        "Other"] %}
                        <option value="{{ cat }}" {% if request.args.get('category')==cat %}selected{% endif %}>{{
                            t('marketplace.categories.' + cat) }}</option>
                        {% endfor %}
                    </select>
                    <select name="type">
                        <option value="">{{ t('marketplace.allTypes') }}</option>
                        <option value="Exchange" {% if request.args.get('type')=='Exchange' %}selected{% endif %}>{{
                            t('marketplace.exchange') }}</option>
                        <option value="Donate" {% if request.args.get('type')=='Donate' %}selected{% endif %}>{{
                            t('marketplace.donate') }}</option>
                    </select>
                    <button type="submit" class="btn-secondary">{{ t('marketplace.applyFilters') }}</button>
                </div>
            </form>
        </div>

        <div class="listings-grid">
            {% if listings %}
            {% for listing in listings %}
            <div class="listing-card">
                <div class="listing-badge {{ listing['listing_type'].lower() }}">
                    {{ t('marketplace.' + listing['listing_type'].lower()) }}
                </div>
                {% if listing['image_path'] %}
                <img src="{{ url_for('static', filename=listing['image_path']) }}" alt="{{ listing['title'] }}">
                {% else %}
                <div class="listing-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
                {% endif %}
                <div class="listing-content">
                    <h3>{{ listing['title'] }}</h3>
                    <p class="listing-description">{{ listing['description'][:100] }}{% if listing['description']|length
                        > 100 %}...{% endif %}</p>
                    <div class="listing-meta">
                        <span class="condition">{{ t('status.' + listing['condition']) }}</span>
                        <span class="category">{{ t('marketplace.categories.' + listing['category']) }}</span>
                    </div>
                    <div class="listing-footer">
                        <div class="user-info">
                            <span class="user-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </span>
                            <div>
                                <strong>{{ listing['display_name'] }}</strong>
                                <span>üìç {{ listing['location'] }}</span>
                            </div>
                        </div>
                        {% if listing['user_id'] != session.get('user_id') %}
                        <a href="{{ url_for('request_item', listing_id=listing['id']) }}"
                            class="btn-primary btn-small">{{ t('marketplace.request') }}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="empty-state">
                <span class="empty-icon">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                    </svg>
                </span>
                <h3>{{ t('marketplace.noItems') }}</h3>
                <p>{{ t('marketplace.noItems') }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}